<!-- 
   *===================================================================================================
   * Date         : 04/06/2018
   * Developer    : Rajesh Pennam
   * Purpose      : This is the VF page for AIA Customer Service which is used in Custom button on the 
   *                Accounts related list of Customer Service number.
   *===================================================================================================
   *                                 Update History
   *                                 ---------------
   * Date          Developer     Tag   Description
   *===================================================================================================
   * 02/12/2018 | Rajesh Pennam |    | This page is used to view/create new customer service numbers
   * 06/08/2018 | Gayathri      | T01| Added a button and logic to render this page in Account as inline vf.
   * 10/07/2018 | Ravi         	| T02| Removed padding right and modified css accordingly to align the buttons
   *===================================================================================================
   -->
<!-- T01 Start -->
<!--<apex:page standardController="Customer_Service__c"  id="pge" recordSetVar="Customer_Service" extensions="AIA_CSNumController" sidebar="false" lightningStylesheets="true">-->
<apex:page controller="AIA_CSNumController" standardStylesheets="true" lightningStylesheets="true" showHeader="true" sidebar="true">  
<!-- T01 End -->
    <style>
      .message.errorM3{
      display:none;
      }
      .size:not(.multi){
      width:120px;
      }
      .headerRow{
      overflow-x: auto;
      }
      .container {
      min-width: 100%;
      }​
      select[multiple], select[size] {
      font-size: 12px;
      }
      th[id*='gsrfhide'], td[id*='gsrfhide'],.dateFormat{
      display:none;
      }
        <!--T02 -start -->
      {! IF(!IsClassic,'.pbButton{text-align: center !important;}','')}        
      <!--T02 -End -->
      {! IF(!IsClassic,'input,select,textarea{min-width:0rem !important;}','')}
      //T01--Start
      {! IF(!IsClassic,'.firstcls {width:50px; text-align:center;}.prevcls {width:50px; text-align:center;}.nextcls {width:50px; text-align:center;}.lastcls {width:50px; text-align:center;}','')}
      //T01--Start
    </style>
   <apex:form id="myform">
      <!--- This block is for the user to enter the details and save   --->
      <apex:outputPanel id="msgPnl">
         <apex:outputPanel styleClass="popupBox" layout="block" rendered="{!displayPopUp}">
            <div align="center">
               <apex:outputText value="{!recordsCount} Records Saved." style="Color:Blue;font-size:20px"/>
               <br/>
            </div>
         </apex:outputPanel>
          <!-- T01 -- Button to edit or create Customer Service Numbers-->
          <div style="float:right;">
           	<apex:commandButton value="View/Add Customer Service Details" action="{!viewEditCSNum}" immediate="true"  rendered="{!IF(AND(hasCreateOpt,Not(enablePage)),true,false)}"/> 
          </div>
          
      </apex:outputPanel>
      <!-- This panel will be rendered and will be visible only for ADR/AIA Admins -->
      <apex:outputPanel styleClass="table-responsive" id="cndchlDiv"  rendered="{!IF(AND(hasCreateOpt,enablePage),true,false)}">
         <!-- rendered="{!hasCreateOpt}" -->
         <apex:pageBlock title="Add Customer Service"  id="pb1">
            <!--<apex:variable var="i" value="{!0}"/>-->
            <apex:pageBlockButtons location="top" >
               <apex:commandButton value="Save" action="{!saveRec}"   />
               <!--- This function used to save the record once user enter the details   -->
               <apex:commandButton value="Cancel" action="{!addrowcancel}" immediate="true" />
               <!-- This function is used to cancel the current page and redirect to Accounts Detail Page --->
               <apex:commandButton value="Back to Account" action="{!addrowcancel}" immediate="true"/>
               <!-- This function is used to redirect to accounts page  --->
            </apex:pageBlockButtons>
            <!--<apex:pageBlockSection>-->
            <apex:pageBlockTable value="{!csnLSt}" var="cns" id="table"  styleClass="slds-table slds-table_bordered slds-table_cell-buffer" >
               <apex:variable value="{!0}" var="Cnt"/>
               <apex:column headervalue="Action" >
                  <apex:commandlink value="Del" action="{!removeRowFromList}" immediate="true"   > <!-- style="color:red;size:2px" -->
                     <!-- Pass the row number to the controller so that we know which row to remove -->
                     <apex:param name="index" value="{!Cnt}" assignTo="{!rowToRemove}"/>
                  </apex:commandlink>
                  <apex:variable var="Cnt" value="{!Cnt+1}"/>
               </apex:column>
               <apex:column headerValue="Area"  >
                  <apex:inputField value="{!cns.Area__c}"  required="true"  styleClass="slds-input size" style="{!IF(isClassic,'','height:30px;')}" />
               </apex:column>
               <apex:column headerValue="Other Area"   >
                  <apex:inputField value="{!cns.Other_Area__c}"  styleClass="size grpname"/>
               </apex:column>
               <apex:column headerValue="Service Number Type"  >
                  <apex:inputField value="{!cns.Service_Number__c}" required="true"  styleClass="slds-input size" style="{!IF(isClassic,'','height:30px;')}"/>
               </apex:column>
               <apex:column headerValue="Phone Number" >
                  <apex:inputField value="{!cns.Phone_Number__c}" required="true" onkeypress="return inputLimiter(event,'Numbers');" styleClass="size grpname" />
                  <!--<p id="demo{!Cnt}"></p>-->
               </apex:column>
               <apex:column headerValue="Service Hours" >
                  <apex:inputField value="{!cns.Service_Hours__c}" id="txtMobId" required="true" styleClass="slds-input size" style="{!IF(isClassic,'','height:30px;')}"/>
               </apex:column>
               <apex:column headerValue="Effective Date"   >
                  <apex:inputField value="{!cns.Effective_Date__c}"  required="true"   />
               </apex:column>
               <apex:column headerValue="Term Date"  >
                  <apex:inputField value="{!cns.Term_Date__c}"  />
               </apex:column>
               <apex:column headerValue="Comments" id="comm"  >
                  <div id="comm{!Cnt}" style="padding-top:15px;">
                     <apex:inputField value="{!cns.Comments__c}" styleClass="size " />
                  </div>
                  <p id="errorcomm{!Cnt}"></p>
               </apex:column>
            </apex:pageBlockTable>
            <!--</apex:pageBlockSection>-->
            <apex:pageblockButtons location="bottom">
               <div style="text-align:Middle;margin-right:30px;font-weight:bold;">
                  <apex:commandLink value="Add New Row" action="{!addRow}"  immediate="true" />
                  &nbsp;|&nbsp;&nbsp;
                  <apex:commandLink value="Remove Last Row" action="{!removeRow}" immediate="true" />
               </div>
            </apex:pageblockButtons>
         </apex:pageBlock>
      </apex:outputPanel>
      <!-- This style is used for Active and Inactive Panels background rendering -->
      <!--  <style>
         .activeTab { background-color: #F1F1F1; color:black; background-image:none; height:22px; font-family:Arial,​Helvetica,​sans-serif; font-size:12px }
         .inactiveTab {  color:black; background-image:none; height:22px; font-family:Arial,​Helvetica,​sans-serif; font-size:12px }
         .rich-tabhdr-side-cell {
             border-top-color: #f9f0f0 !important;
             padding-bottom: 6px !important;
         }
         </style> -->
   </apex:form>
   <!-- This block is used for All AIA Users to view records in Active/Inactive Panels -->
   <apex:form id="myform1" rendered="{!formdisplay}">
      <!--- This is block is used to display the active records, If Term Data is Blank then those records will be in Active Tab  -->    
      <apex:outputPanel id="tabpnlDiv">
         <!-- This panel is used for redirect the Customer Service VF Page for user to enter detials --->
         <apex:outputPanel id="rern">
            <apex:pageMessages id="testmsg"/>
         </apex:outputPanel>
         <apex:tabPanel switchType="client" value="{!tabSelected}"  id="theTabPanel" tabClass="activeTab" inactiveTabClass="inactiveTab">
            <apex:tab label="Active" name="Active" id="tabOne">
               <apex:outputPanel id="tableactPnl">
                  <apex:pageBlock rendered="{!ActiveCSN.size==0}"> No records</apex:pageBlock>
                  <apex:pageBlock id="pb" rendered="{!ActiveCSN.size>0}">
                     <apex:variable value="{!1}" var="rowNum"/>
                     <!--T01 --Start-- Updated rendered attribute to hide the buttons in related list view-->
                      <apex:pageBlockButtons location="top">
                        <!-- rendered="{!hasCreateOpt}" -->
                        <apex:commandButton value="Save" action="{!save1}" rendered="{!IF(AND(hasCreateOpt,enablePage),true,false)}" />
                         <apex:commandButton value="Edit" action="{!editTable}"  rendered="{!IF(AND(hasCreateOpt,enablePage),true,false)}" />
                         <apex:commandButton value="Back to Account" action="{!addrowcancel}" immediate="true" rendered="{!IF(AND(NOT(hasCreateOpt),enablePage),true,false)}"/>
                         <apex:commandButton value="Cancel" action="{!canceDetails}" immediate="true" rendered="{!IF(AND(hasCreateOpt,enablePage),true,false)}"/>
                         <!-- T01 -- Button to edit or create Customer Service Numbers-->
                         <!--<apex:commandButton value="View/Add Customer Service Details" action="{!viewEditCSNum}" immediate="true" rendered="{!IF(AND(hasCreateOpt,Not(enablePage)),true,false)}"/>-->
                     </apex:pageBlockButtons>
                     <!--T01 --End-->
                     <apex:outputPanel id="rern">
                     <apex:pageBlockTable value="{!ActiveCSN}" var="act" id="tableact" rendered="{!!editMode}">
                        <!--T01 -- Start-->
                         <apex:column headerValue="Action" rendered="{!IF(AND(hasCreateOpt,enablePage),true,false)}">
                        <!--T01 -- End-->
                             <apex:commandLink value="Del" action="{!deleteRec}"  styleClass="delete"  >
                              <apex:param name="recid" value="{!act.id}" />
                           </apex:commandLink>
                        </apex:column>
                        
                        <apex:column headerValue="Area" >
                           <apex:outputfield value="{!act.Area__c}"/>
                        </apex:column>
                        <apex:column headerValue="Other Area" >
                           <apex:outputfield value="{!act.Other_Area__c}"/>
                        </apex:column>
                        <apex:column headerValue="Service Number Type" >
                           <apex:outputfield value="{!act.Service_Number__c}"/>
                        </apex:column>
                        <apex:column headerValue="Phone Number" >
                           <apex:outputfield value="{!act.Phone_Number__c}" />
                        </apex:column>
                        <apex:column headerValue="Service Hours" >
                           <apex:outputfield value="{!act.Service_Hours__c}" />
                        </apex:column>
                        <apex:column headerValue="Effective Date" >
                           <apex:outputfield value="{!act.Effective_Date__c}" />
                        </apex:column>
                        <apex:column headerValue="Term date" >
                           <apex:outputfield value="{!act.Term_Date__c}"/>
                        </apex:column>
                        <!-- <apex:column value="{!act.Comments__c}"/> -->
                        <apex:column headerValue="Comments" style="width: 183px !important;word-wrap: break-word !important;min-width: 100px !important;">
                           <apex:outputField value="{!act.Comments__c}"  />
                        </apex:column>
                        <apex:variable var="rowNum" value="{!rowNum+1}"/>
                     </apex:pageBlockTable>
                     
                      <apex:pageBlockTable value="{!ActiveCSN}" var="act" id="tableact2" rendered="{!editMode}">
                                   <apex:column headerValue="Area"  >
                              <apex:inputField value="{!act.Area__c}"  required="true"  styleClass="slds-input size" style="{!IF(isClassic,'','height:30px;')}" />
                           </apex:column>
                           <apex:column headerValue="Other Area"   >
                              <apex:inputField value="{!act.Other_Area__c}"  styleClass="size grpname"/>
                           </apex:column>
                           <apex:column headerValue="Service Number Type"  >
                              <apex:inputField value="{!act.Service_Number__c}" required="true"  styleClass="slds-input size" style="{!IF(isClassic,'','height:30px;')}"/>
                           </apex:column>
                           <apex:column headerValue="Phone Number" >
                              <apex:inputField value="{!act.Phone_Number__c}" required="true" onkeypress="return inputLimiter(event,'Numbers');" styleClass="size grpname" />
                              <!--<p id="demo{!Cnt}"></p>-->
                           </apex:column>
                           <apex:column headerValue="Service Hours" >
                              <apex:inputField value="{!act.Service_Hours__c}" id="txtMobId" required="true" styleClass="slds-input size" style="{!IF(isClassic,'','height:30px;')}"/>
                           </apex:column>
                           <apex:column headerValue="Effective Date"   >
                              <apex:inputField value="{!act.Effective_Date__c}"  required="true"   />
                           </apex:column>
                           <apex:column headerValue="Term Date"  >
                              <apex:inputField value="{!act.Term_Date__c}"  />
                           </apex:column>
                           <apex:column headerValue="Comments" id="comm"  >
                              <apex:inputField value="{!act.Comments__c}" styleClass="size " />
                            </apex:column>
               
                       
                     </apex:pageBlockTable>
                     </apex:outputpanel>
                     <apex:panelGrid columns="5" columnClasses="firstcls,prevcls,nextcls,lastcls,pgNum" cellpadding="0" cellspacing="0">
                        <apex:commandButton status="fetchStatus"  value="|<" action="{!setCon.first}" disabled="{!!setCon.hasPrevious}" title="First Page"/>
                        <apex:commandButton status="fetchStatus" value="<" action="{!setCon.previous}" disabled="{!!setCon.hasPrevious}" title="Previous Page"/>
                        <apex:commandButton status="fetchStatus"  value=">" action="{!setCon.next}" disabled="{!!setCon.hasNext}" title="Next Page"/>
                        <apex:commandButton status="fetchStatus"  value=">|" action="{!setCon.last}" disabled="{!!setCon.hasNext}" title="Last Page"/>
                        <apex:outputText >{!(setCon.pageNumber * size)+1-size}-{!IF((setCon.pageNumber * size)>noOfRecords, noOfRecords,(setCon.pageNumber * size))} of {!noOfRecords}</apex:outputText>
                        <!--<apex:commandButton status="fetchStatusAct" value="Refresh" action="{!refresh}" title="Refresh Page"/>
                           <apex:outputPanel style="color:#4AA02C;font-weight:bold">
                               <apex:actionStatus id="fetchStatusAct" startText="Fetching..." stopText=""/>
                           </apex:outputPanel>-->                       
                     </apex:panelGrid>
                  </apex:pageBlock>
               </apex:outputPanel>
            </apex:tab>
            <!-------------------------------------------------------------------------------------------------------------------------------------------->
            <!--- This is block is used to display the In-active records, If Term Data is Not Blank then those records will be in In-Active Tab  --> 
            <apex:tab label="InActive" name="InActive" id="tabTwo">
               <apex:outputPanel id="tablePnl">
                  <apex:pageBlock rendered="{!InActiveCSN.size==0}"> No records</apex:pageBlock>
                  <apex:pageBlock id="inactpb" rendered="{!InActiveCSN.size>0}">
                     <!--T01 -- Start-- Updated rendered in command buttons to hide these buttons in related list view-->
                      <apex:pageBlockButtons rendered="{!hasCreateOpt}" location="top">
                        <apex:commandbutton value="Save" action="{!saveinAct}" rendered="{!IF(AND(hasCreateOpt,enablePage),true,false)}"/>
                        <apex:commandButton value="Edit" action="{!editInactTable}"  rendered="{!IF(AND(hasCreateOpt,enablePage),true,false)}" />
                        <apex:commandButton value="Back to Account" action="{!addrowcancel}" immediate="true" rendered="{!IF(AND(NOT(hasCreateOpt),enablePage),true,false)}"/>
                         <apex:commandButton value="Cancel" action="{!canceDetails}" rendered="{!IF(AND(hasCreateOpt,enablePage),true,false)}" immediate="true"/>
                      </apex:pageBlockButtons>
                      <!--T01 -- End-->
                     <!--  <div style="overflow: scroll; height: 200px;"> -->
                     <apex:outputPanel id="ren2">
                     <apex:pageBlockTable value="{!InActiveCSN}" var="inAct" id="tableInact" rendered="{!!inactEditMode}">
                        <apex:column headerValue="Action" rendered="{!IF(AND(hasCreateOpt,enablePage),true,false)}">
                           <apex:commandLink value="Del" action="{!deleteRec}"  styleClass="delete" >
                              <!-- rerender="tablePnl,tableInact" -->
                              <apex:param name="recid" value="{!inAct.id}" />
                           </apex:commandLink>
                        </apex:column>
                        <apex:column headerValue="Area" >
                           <apex:outputfield value="{!inAct.Area__c}"/>
                        </apex:column>
                        <apex:column headerValue="Other Area" >
                           <apex:outputfield value="{!inAct.Other_Area__c}"/>
                        </apex:column>
                        <apex:column headerValue="Service Number Type" >
                           <apex:outputfield value="{!inAct.Service_Number__c}"/>
                        </apex:column>
                        <apex:column headerValue="Phone Number" >
                           <apex:outputfield value="{!inAct.Phone_Number__c}"/>
                        </apex:column>
                        <apex:column headerValue="Service Hours" >
                           <apex:outputfield value="{!inAct.Service_Hours__c}" />
                        </apex:column>
                        <apex:column headerValue="Effective Date" >
                           <apex:outputfield value="{!inAct.Effective_Date__c}"/>
                        </apex:column>
                        <apex:column headerValue="Term date" >
                           <apex:outputfield value="{!inAct.Term_Date__c}"/>
                        </apex:column>
                        <!-- <apex:column value="{!inAct.Comments__c}"/> -->
                        <apex:column headerValue="Comments" style="width: 183px !important;word-wrap: break-word !important;min-width: 100px !important;">
                           <apex:outputfield value="{!inAct.Comments__c}" />
                        </apex:column>
                     </apex:pageBlockTable>
                     <apex:pageBlockTable value="{!InActiveCSN}" var="inAct" id="tableact2" rendered="{!inactEditMode}">
                            <apex:column headerValue="Area"  >
                              <apex:inputField value="{!inAct.Area__c}"  required="true"  styleClass="slds-input size" style="{!IF(isClassic,'','height:30px;')}" />
                           </apex:column>
                           <apex:column headerValue="Other Area"   >
                              <apex:inputField value="{!inAct.Other_Area__c}"  styleClass="size grpname"/>
                           </apex:column>
                           <apex:column headerValue="Service Number Type"  >
                              <apex:inputField value="{!inAct.Service_Number__c}" required="true"  styleClass="slds-input size" style="{!IF(isClassic,'','height:30px;')}"/>
                           </apex:column>
                           <apex:column headerValue="Phone Number" >
                              <apex:inputField value="{!inAct.Phone_Number__c}" required="true" onkeypress="return inputLimiter(event,'Numbers');" styleClass="size grpname" />
                              <!--<p id="demo{!Cnt}"></p>-->
                           </apex:column>
                           <apex:column headerValue="Service Hours" >
                              <apex:inputField value="{!inAct.Service_Hours__c}" id="txtMobId" required="true" styleClass="slds-input size" style="{!IF(isClassic,'','height:30px;')}"/>
                           </apex:column>
                           <apex:column headerValue="Effective Date"   >
                              <apex:inputField value="{!inAct.Effective_Date__c}"  required="true"   />
                           </apex:column>
                           <apex:column headerValue="Term Date"  >
                              <apex:inputField value="{!inAct.Term_Date__c}"  />
                           </apex:column>
                           <apex:column headerValue="Comments" id="comm"  >
                              <apex:inputField value="{!inAct.Comments__c}" styleClass="size " />
                            </apex:column>
                     </apex:pageBlockTable>
                     </apex:outputPanel>
                     <!------------------------------------------------------------------------------------------------------------------------------------------------>
                     <!-- This Block is used for Pagination -->
                     <apex:panelGrid columns="5" columnClasses="firstcls,prevcls,nextcls,lastcls,pgNum" cellpadding="0" cellspacing="0">
                        <apex:commandButton status="fetchStatus"  value="|<" action="{!inActSetCon.first}" disabled="{!!inActSetCon.hasPrevious}" title="First Page"/>
                        <apex:commandButton status="fetchStatus"  value="<" action="{!inActSetCon.previous}" disabled="{!!inActSetCon.hasPrevious}" title="Previous Page"/>
                        <apex:commandButton status="fetchStatus"  value=">" action="{!inActSetCon.next}" disabled="{!!inActSetCon.hasNext}" title="Next Page"/>
                        <apex:commandButton status="fetchStatus"  value=">|" action="{!inActSetCon.last}" disabled="{!!inActSetCon.hasNext}" title="Last Page"/>
                        <!--<apex:outputText >{!(inActSetCon.pageNumber * inActsize)+1-inActsize}-{!IF((inActSetCon.pageNumber * inActsize)>inActnoOfRecords, inActnoOfRecords,(inActSetCon.pageNumber * inActsize))} of {!inActnoOfRecords}</apex:outputText>-->
                        <apex:outputText >{!(inActSetCon.pageNumber * inActsize)+1-inActsize}-{!IF((inActSetCon.pageNumber * inActsize)>inActnoOfRecords, inActnoOfRecords,(inActSetCon.pageNumber * inActsize))} of {!inActnoOfRecords}</apex:outputText>
                        <!--<apex:commandButton status="fetchStatus" value="Refresh" action="{!InActrefresh}" title="Refresh Page"/>
                           <apex:outputPanel style="color:#4AA02C;font-weight:bold">
                               <apex:actionStatus id="fetchStatus" startText="Fetching..." stopText=""/>
                           </apex:outputPanel>-->
                     </apex:panelGrid>
                  </apex:pageBlock>
               </apex:outputPanel>
            </apex:tab>
         </apex:tabPanel>
         <apex:outputPanel id="buttons" style="float:right !important;">
            <!-- <apex:commandButton status="fetchStatus" value="Refresh BothPannels" action="{!refreshCNSNew}" title="Refresh Page"/> -->
            <apex:outputPanel style="color:#4AA02C;font-weight:bold">
               <apex:actionStatus id="fetchStatus" startText="Fetching..." stopText=""/>
            </apex:outputPanel>
         </apex:outputPanel>
      </apex:outputPanel>
      <!--  The below script is used to control user to not to enter more than 10 digits in Phone number field ---->
      <script>
         function inputLimiter(e,allow) {
             var AllowableCharacters = '';
             var phoneNumber = e.target.value.length;
             console.log('phon***'+phoneNumber);
             if (allow == 'Letters'){AllowableCharacters=' ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';}
             if (allow == 'Numbers'){AllowableCharacters='1234567890';}
             if (allow == 'NameCharacters'){AllowableCharacters=' ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-.\'';}
             if (allow == 'NameCharactersAndNumbers'){AllowableCharacters='1234567890 ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-\'';}
             if (allow == 'Currency'){AllowableCharacters='1234567890.';}
             if(phoneNumber<10){
                 var k = document.all?parseInt(e.keyCode): parseInt(e.which);
                 if (k!=13 && k!=8 && k!=0){
                     if ((e.ctrlKey==false) && (e.altKey==false)) {
                     return (AllowableCharacters.indexOf(String.fromCharCode(k))!=-1);
                     } else {
                     return true;
                     }
                 } else {
                     return true;
                 }
             }
             else{
                 return false;
             }
         }
         
      </script>
      <script type="text/javascript">
         function ValidateMobNumber(mobilenum,count) {
             //var mob = /^(\+91[\-\s]?)\d{10}$/;
             var mob = /^(?:[0-9] ?){1,10}[0-9]$/;
             
             var txtMobile = mobilenum.value;
             console.log('mobile***'+txtMobile);
             //var txtMobile = document.getElementById('{!$Component.myform.txtMobId}');
             if (mob.test(txtMobile) == false) {
                 //alert("Please enter valid mobile number.");
                 //txtMobile.focus();
                 console.log('Cnt****'+count);
                 var demcnt ="demo"+count;
                 document.getElementById(demcnt).innerHTML = 'Phone number not valid';
                 document.getElementById(demcnt).style.color = 'red';
                 return false;
             }
             else{
                 var demcnt ="demo"+count;
                 document.getElementById(demcnt).innerHTML = '';
             return true;
             }
         }
 
      </script>
   </apex:form>
</apex:page>